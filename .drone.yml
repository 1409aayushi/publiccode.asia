pipeline:
  build:
    image: rics3n/drone-ansible
    commands:
        - ansible-playbook -vvv playbook.yml -i hosts --syntax-check

  deploy:
    image: rics3n/drone-ansible
    secrets: [ ssh_key ]
    commands:
      - env
      - echo "$SSH_KEY"
      - mkdir /root/.ssh && echo "$SSH_KEY" > /root/.ssh/id_rsa && chmod 0600 /root/.ssh/id_rsa
      - ansible-playbook playbook.yml -i hosts
    when:
       branch: master

